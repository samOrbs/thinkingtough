{
	"nodes":[
		{"id":"g3","type":"group","x":960,"y":1380,"width":1900,"height":830,"color":"4","label":"PHASE 3: RETRIEVAL PIPELINE ✅ MULTI-BOOK (rerank + HyDE + classify) — ~$0.001/query"},
		{"id":"g2","type":"group","x":960,"y":530,"width":1900,"height":760,"color":"6","label":"PHASE 2: INDEXING PIPELINE ✅ PER-BOOK + ENRICHED — $0.35/book"},
		{"id":"g4","type":"group","x":960,"y":2360,"width":1900,"height":420,"color":"5","label":"PHASE 4: GENERATION ✅ DYNAMIC MULTI-BOOK PROMPT — $0.001/query"},
		{"id":"g6","type":"group","x":3060,"y":2060,"width":750,"height":1020,"color":"2","label":"PHASE 6: AGENTIC LAYER — ⏳ NOT YET STARTED"},
		{"id":"g1","type":"group","x":960,"y":0,"width":1900,"height":380,"color":"1","label":"PHASE 1: DOCUMENT PROCESSING ✅ MULTI-BOOK + PDF — $0.06/JPG book, $0/text PDF"},
		{"id":"g5","type":"group","x":3060,"y":980,"width":750,"height":800,"color":"3","label":"PHASE 5: MEMORY & PERSISTENCE — ✅ basic SQLite + book selection"},
		{"id":"g7","type":"group","x":960,"y":2930,"width":950,"height":500,"color":"4","label":"EVALUATION & TESTING — ⏳ NOT YET STARTED"},
		{"id":"g8","type":"group","x":2060,"y":2930,"width":800,"height":500,"color":"5","label":"DEPLOYMENT"},
		{"id":"g0","type":"group","x":960,"y":-500,"width":1900,"height":380,"color":"3","label":"BOOK REGISTRY — src/books.py + books/*/config.json"},
		{"id":"f1","type":"file","file":"02-document-processing/Overview.md","x":4320,"y":-290,"width":1680,"height":6700},
		{"id":"f2","type":"file","file":"03-indexing-pipeline/Overview.md","x":6080,"y":-290,"width":1020,"height":13210},
		{"id":"f3","type":"file","file":"04-retrieval-pipeline/Overview.md","x":7160,"y":-290,"width":1680,"height":10210},
		{"id":"f4","type":"file","file":"05-generation-layer/Overview.md","x":8880,"y":-290,"width":1860,"height":8050},
		{"id":"f5","type":"file","file":"06-memory-persistence/Overview.md","x":10800,"y":-290,"width":1200,"height":10150},
		{"id":"f6","type":"file","file":"07-agentic-layer/Overview.md","x":12040,"y":-290,"width":2200,"height":12370},
		{"id":"f7","type":"file","file":"08-evaluation-testing/Overview.md","x":14280,"y":-290,"width":1680,"height":10570},
		{"id":"f8","type":"file","file":"09-deployment/Overview.md","x":16000,"y":-290,"width":1280,"height":11170},
		{"id":"p0_registry","type":"text","text":"**BookConfig Dataclass** ✅\nslug, title, author, total_pages\nskip_pages, source_type, topics\nDerived: pages_dir, markdown_dir,\nchroma_dir, bm25_path, collection_name","x":1060,"y":-420,"width":320,"height":150,"color":"3"},
		{"id":"p0_config","type":"text","text":"**Per-Book config.json** ✅\n`books/{slug}/config.json`\n4 books configured:\n• toughness-training (JPG)\n• mindful-athlete (JPG)\n• winning-in-mind (JPG)\n• inner-game-of-tennis (PDF)","x":1460,"y":-420,"width":320,"height":180,"color":"3"},
		{"id":"p0_discover","type":"text","text":"**Discovery Functions** ✅\n`discover_books()` — glob configs\n`get_indexed_books()` — filter\nto books with chroma_db/\n`load_config(slug)` — load one","x":1860,"y":-420,"width":320,"height":150,"color":"3"},
		{"id":"p5_budget","type":"text","text":"**Context Window Budget**\nTier 1 Core: 2,200 tokens (cached)\nTier 2 Working: 7,500 tokens\nTier 3 Long-term: unlimited (SQLite)\nTotal per query: ~10,700 tokens","x":3210,"y":1390,"width":320,"height":160,"color":"3"},
		{"id":"p5_facts","type":"text","text":"**Auto Fact Extraction**\nKey facts saved from every\nresponse, with embeddings\nfor semantic retrieval","x":3160,"y":1230,"width":280,"height":120,"color":"3"},
		{"id":"p5_session","type":"text","text":"**Session Manager** ✅\nSession create + history\nLast 20 turns loaded\nBook selection persistence ✅","x":3160,"y":1070,"width":280,"height":120,"color":"3"},
		{"id":"p5_sqlite","type":"text","text":"**SQLite Database** ✅\n`data/memory.db`\nconversations table\nsessions table + selected_books","x":3510,"y":1070,"width":240,"height":120,"color":"3"},
		{"id":"p5_notes","type":"text","text":"**User Notes & Plans**\nPersistent across sessions\nTagged and searchable","x":3510,"y":1230,"width":240,"height":120,"color":"3"},
		{"id":"p6_router","type":"text","text":"**Agent Router (Intent Detection)**\nDirect question → RAG pipeline\nTool request → Tool Executor\nNative Claude/Gemini tool use","x":3210,"y":2090,"width":320,"height":120,"color":"2"},
		{"id":"p6_search","type":"text","text":"**search_book()**\nQuery the book\n**get_page()**\nFull page text","x":3160,"y":2300,"width":220,"height":110,"color":"2"},
		{"id":"p6_notes_tool","type":"text","text":"**create_note()**\nSave study notes\n**search_notes()**\nFind past notes","x":3450,"y":2300,"width":220,"height":110,"color":"2"},
		{"id":"p6_analysis","type":"text","text":"**summarize_chapter()**\nChapter summaries\n**compare_concepts()**\nSide-by-side analysis","x":3450,"y":2440,"width":220,"height":110,"color":"2"},
		{"id":"p6_study","type":"text","text":"**create_plan()**\nStudy/training plans\n**create_flashcards()**\nQ&A card generation","x":3160,"y":2440,"width":220,"height":110,"color":"2"},
		{"id":"p6_react","type":"text","text":"**ReAct Execution Loop**\nReason → Act → Observe → Repeat\nMax 5 tool calls per query\nNo framework — native API tool use","x":3210,"y":2590,"width":320,"height":120,"color":"2"},
		{"id":"p6_guards","type":"text","text":"**Guardrails**\nInput validation per tool\nCost controls: $2/day budget\nRate limiting, size limits","x":3210,"y":2750,"width":320,"height":120,"color":"2"},
		{"id":"p2_raptor","type":"text","text":"**RAPTOR Summaries**\nTree of Abstractions\nL0: 300 chunks\nL1: ~30 cluster summaries\nL2: ~5 section summaries\nL3: 1 book summary","x":2100,"y":655,"width":280,"height":190,"color":"6"},
		{"id":"p2_bm25","type":"text","text":"**BM25 Index Build** ✅\nrank_bm25 (OkapiBM25)\nPer-book: `books/{slug}/bm25_index.pkl`\nPlain dict chunks in pickle","x":1840,"y":875,"width":260,"height":130,"color":"6"},
		{"id":"p2_embed","type":"text","text":"**gemini-embedding-001** ✅\n3072 dims, #1 MTEB (68.32)\nFree tier / $0.001 per batch\nbook_slug + book_title in metadata","x":1060,"y":940,"width":270,"height":90,"color":"6"},
		{"id":"p2_chroma","type":"text","text":"**ChromaDB** ✅ per-book\n`books/{slug}/chroma_db/`\nCollection: slug with _ separator","x":1060,"y":1080,"width":240,"height":60},
		{"id":"p2_bm25_store","type":"text","text":"**BM25 Index** File\n`books/{slug}/bm25_index.pkl`","x":1710,"y":1140,"width":240,"height":70},
		{"id":"p2_enrich","type":"text","text":"**Contextual Enrichment** ✅\nAnthropic Method (confirmed 2026)\nDynamic: references book.title\nand book.author in prompt","x":1360,"y":770,"width":280,"height":140,"color":"6"},
		{"id":"p2_chunk","type":"text","text":"**Semantic Chunking** ✅\n~400 tokens, 80 overlap\nCross-page paragraph splits\nDedup + skip front/back matter\nbook_slug in chunk metadata","x":1360,"y":610,"width":280,"height":140,"color":"6"},
		{"id":"f0","type":"file","file":"01-system-overview/System Diagram.md","x":1260,"y":-130,"width":400,"height":50},
		{"id":"p1_ocr","type":"text","text":"**Gemini 2.0 Flash** ✅\n**OCR Transcription**\nJPG pages → markdown\nPer-book: `books/{slug}/pages/`","x":1380,"y":80,"width":270,"height":110,"color":"1"},
		{"id":"p1_pdf","type":"text","text":"**PDF Support** ✅ NEW\n**Auto-detect text vs scanned**\nText PDF → direct extract ($0)\nScanned PDF → render + OCR\nPyMuPDF (fitz)","x":1740,"y":80,"width":270,"height":130,"color":"1"},
		{"id":"p7_deep","type":"text","text":"**DeepEval Metrics**\nHallucination < 0.1\nAnswer Correctness > 0.8\nContextual Relevancy > 0.8\nToxicity & Bias checks","x":1430,"y":3170,"width":280,"height":200},
		{"id":"p7_ragas","type":"text","text":"**RAGAS Metrics**\nFaithfulness > 0.9\nAnswer Relevancy > 0.85\nContext Precision > 0.8\nContext Recall > 0.8","x":1060,"y":3170,"width":280,"height":200},
		{"id":"p7_latency","type":"text","text":"**Latency Benchmarks**\nSimple query: < 3s (first token)\nComplex query: < 6s (first token)\nVector search: < 50ms\nRerank: < 300ms","x":1430,"y":3010,"width":280,"height":160},
		{"id":"p7_dataset","type":"text","text":"**Test Dataset**\n50+ gold Q&A pairs\n7 categories: factual,\nconceptual, cross-chapter,\npage-specific, summary, negative","x":1060,"y":2975,"width":280,"height":175},
		{"id":"p8_cost","type":"text","text":"**Total Cost**\nOne-time setup: **~$1.60**\n(4 books indexed)\nPer query average: **$0.009**\nInfrastructure: **Free** (local)","x":2160,"y":3170,"width":280,"height":160},
		{"id":"p8_stack","type":"text","text":"**Tech Stack**\nPython 3.12 + Chainlit\nSQLite + ChromaDB\nAll local, fully portable\nNo cloud infra required","x":2520,"y":3170,"width":260,"height":160},
		{"id":"p8_chainlit","type":"text","text":"**Chainlit Chat UI** ✅\nStreaming responses\nSource citations in sidebar\nBook toggle switches ✅ NEW\n`chainlit run app.py` → :8000","x":2160,"y":3010,"width":280,"height":160,"color":"5"},
		{"id":"p8_docker","type":"text","text":"**Docker Deployment**\nSingle container\nPersistent volume for data\nPython 3.12-slim base\nPort 8000","x":2520,"y":3010,"width":260,"height":160,"color":"5"},
		{"id":"p3_multi","type":"text","text":"**Multi-Query Expansion** ✅\n2 variants + original (3 total)\nReferences all selected books\nFallback to original on error","x":1060,"y":1600,"width":270,"height":125,"color":"4"},
		{"id":"p3_vector","type":"text","text":"**Vector Search** ✅ MULTI-BOOK\nTop-20 per query per book\nNamespaced IDs: {slug}:{chunk_id}\nSearches each book's ChromaDB","x":1060,"y":1760,"width":250,"height":140,"color":"4"},
		{"id":"p3_classify","type":"text","text":"**Query Understanding** ✅\n**& Classification**\n6 types: factual, conceptual,\ncomparative, page, summary, chat\nRoutes HyDE for conceptual queries","x":1360,"y":1430,"width":280,"height":140,"color":"4"},
		{"id":"p3_hyde","type":"text","text":"**HyDE** ✅\nHypothetical Answer\nReferences all selected books\nFor conceptual queries only","x":1430,"y":1600,"width":270,"height":125,"color":"4"},
		{"id":"p3_query","type":"text","text":"**User Query**\n+ selected books list","x":1060,"y":1460,"width":200,"height":90,"color":"4"},
		{"id":"p3_bm25s","type":"text","text":"**BM25 Search** ✅ MULTI-BOOK\nTop-20 per query per book\nNamespaced IDs: {slug}:{chunk_id}\nSearches each book's BM25 index","x":1430,"y":1760,"width":250,"height":140,"color":"4"},
		{"id":"p3_rrf","type":"text","text":"**Reciprocal Rank Fusion** ✅\nMerge & Deduplicate\nk=60 constant\nNamespaced IDs prevent collisions","x":1790,"y":1725,"width":280,"height":105,"color":"4"},
		{"id":"p3_rerank","type":"text","text":"**LLM Reranker** ✅\nGemini 2.5 Flash cross-encoder\nIncludes book title in scoring\nReturns top-5 by relevance","x":1790,"y":1900,"width":280,"height":130,"color":"4"},
		{"id":"p3_assemble","type":"text","text":"**Context Assembly** ✅\nTop-5 chunks, relevance-ordered\n[Book Title, Page X] multi-book\n[Page X] single-book","x":2190,"y":1900,"width":280,"height":150,"color":"4"},
		{"id":"p4_sys","type":"text","text":"**Dynamic System Prompt** ✅\nSingle book: expert on {title}\nMulti-book: expert on N books\nDynamic citation format rules\n+ context + history (last 20)","x":1060,"y":2440,"width":280,"height":170,"color":"5"},
		{"id":"p4_router","type":"text","text":"**Model Router** ⏳ PLANNED\nSimple → gemini-2.5-flash\nComplex → claude-sonnet-4-5\nCurrently: all Gemini Flash","x":1430,"y":2440,"width":270,"height":170,"color":"5"},
		{"id":"p4_llm","type":"text","text":"**LLM Generation** ✅\ngemini-2.5-flash (migrated)\nStreaming via generate_content_stream\nAll API calls on 2.5-flash","x":1790,"y":2440,"width":280,"height":130,"color":"5"},
		{"id":"p4_valid","type":"text","text":"**Response Validation** ✅\nCitation Check: supports both\n[Page X] and [Book, Page X]\nFlags hallucinated page refs","x":2160,"y":2440,"width":270,"height":130,"color":"5"},
		{"id":"p4_output","type":"text","text":"**Answer with Page Citations**\n~$0.009 average per query","x":1560,"y":2650,"width":340,"height":90},
		{"id":"title","type":"text","text":"# Multi-Book RAG Expert\n## Complete System Architecture\n4 Sports Psychology Books → Conversational AI Expert with Book Toggles","x":1260,"y":-600,"width":700,"height":120},
		{"id":"p1_output","type":"text","text":"**Clean Markdown with Page Metadata**\nPer book: `books/{slug}/pages_markdown/`","x":1660,"y":255,"width":340,"height":85},
		{"id":"p1_clean","type":"text","text":"**Text Cleaning**\n**& Normalization**\nHyphen rejoin, Unicode fix\nRemove headers/footers","x":2100,"y":80,"width":260,"height":110,"color":"1"},
		{"id":"p1_struct","type":"text","text":"**Structure Extraction**\nChapters, Sections\nHeading detection\nCross-reference linking","x":2100,"y":230,"width":260,"height":110,"color":"1"},
		{"id":"p1_input","type":"text","text":"**Multi-Source Input** ✅\nJPG pages (3 books)\nPDF (1 book, auto-detected)\n`books/{slug}/pages/`","x":1060,"y":80,"width":230,"height":110,"color":"1"}
	],
	"edges":[
		{"id":"e_p0_1","fromNode":"p0_registry","fromSide":"right","toNode":"p0_config","toSide":"left","color":"#8b5cf6"},
		{"id":"e_p0_2","fromNode":"p0_config","fromSide":"right","toNode":"p0_discover","toSide":"left","color":"#8b5cf6"},
		{"id":"e_p0_to_p1","fromNode":"p0_config","fromSide":"bottom","toNode":"p1_input","toSide":"top","color":"#e94560","label":"BookConfig"},
		{"id":"e_p1_1","fromNode":"p1_input","fromSide":"right","toNode":"p1_ocr","toSide":"left","color":"#e94560"},
		{"id":"e_p1_1b","fromNode":"p1_input","fromSide":"right","toNode":"p1_pdf","toSide":"left","color":"#e94560"},
		{"id":"e_p1_2","fromNode":"p1_ocr","fromSide":"right","toNode":"p1_clean","toSide":"left","color":"#e94560"},
		{"id":"e_p1_2b","fromNode":"p1_pdf","fromSide":"right","toNode":"p1_clean","toSide":"left","color":"#e94560"},
		{"id":"e_p1_3","fromNode":"p1_clean","fromSide":"bottom","toNode":"p1_output","toSide":"right","color":"#e94560"},
		{"id":"e_p1_to_p2","fromNode":"p1_output","fromSide":"bottom","toNode":"p2_chunk","toSide":"top","color":"#f59e0b","label":"Clean Markdown"},
		{"id":"e_p2_1","fromNode":"p2_chunk","fromSide":"bottom","toNode":"p2_enrich","toSide":"top","color":"#f59e0b"},
		{"id":"e_p2_2","fromNode":"p2_enrich","fromSide":"bottom","toNode":"p2_embed","toSide":"top","color":"#f59e0b","label":"Enriched chunks"},
		{"id":"e_p2_3","fromNode":"p2_enrich","fromSide":"bottom","toNode":"p2_bm25","toSide":"top","color":"#f59e0b","label":"Enriched chunks"},
		{"id":"e_p2_4","fromNode":"p2_chunk","fromSide":"right","toNode":"p2_raptor","toSide":"left","color":"#f59e0b","label":"Raw chunks"},
		{"id":"e_p2_5","fromNode":"p2_embed","fromSide":"bottom","toNode":"p2_chroma","toSide":"top","color":"#f59e0b"},
		{"id":"e_p2_6","fromNode":"p2_bm25","fromSide":"bottom","toNode":"p2_bm25_store","toSide":"top","color":"#f59e0b"},
		{"id":"e_p2_7","fromNode":"p2_raptor","fromSide":"bottom","toNode":"p2_chroma","toSide":"right","color":"#f59e0b","label":"Summary embeddings"},
		{"id":"e_store_to_vector","fromNode":"p2_chroma","fromSide":"bottom","toNode":"p3_vector","toSide":"top","color":"#3b82f6","label":"Vector Store"},
		{"id":"e_store_to_bm25","fromNode":"p2_bm25_store","fromSide":"bottom","toNode":"p3_bm25s","toSide":"top","color":"#3b82f6","label":"BM25 Index"},
		{"id":"e_p3_1","fromNode":"p3_query","fromSide":"right","toNode":"p3_classify","toSide":"left","color":"#3b82f6"},
		{"id":"e_p3_2","fromNode":"p3_classify","fromSide":"bottom","toNode":"p3_multi","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_3","fromNode":"p3_classify","fromSide":"bottom","toNode":"p3_hyde","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_4","fromNode":"p3_multi","fromSide":"bottom","toNode":"p3_vector","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_5","fromNode":"p3_multi","fromSide":"bottom","toNode":"p3_bm25s","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_6","fromNode":"p3_hyde","fromSide":"bottom","toNode":"p3_vector","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_7","fromNode":"p3_vector","fromSide":"right","toNode":"p3_rrf","toSide":"left","color":"#3b82f6","label":"Top-50"},
		{"id":"e_p3_8","fromNode":"p3_bm25s","fromSide":"right","toNode":"p3_rrf","toSide":"left","color":"#3b82f6","label":"Top-50"},
		{"id":"e_p3_9","fromNode":"p3_rrf","fromSide":"bottom","toNode":"p3_rerank","toSide":"top","color":"#3b82f6","label":"~80 unique"},
		{"id":"e_p3_10","fromNode":"p3_rerank","fromSide":"right","toNode":"p3_assemble","toSide":"left","color":"#3b82f6","label":"Top-5"},
		{"id":"e_p3_to_p4","fromNode":"p3_assemble","fromSide":"bottom","toNode":"p4_sys","toSide":"top","color":"#10b981","label":"Retrieved Context"},
		{"id":"e_p4_1","fromNode":"p4_sys","fromSide":"right","toNode":"p4_router","toSide":"left","color":"#10b981"},
		{"id":"e_p4_2","fromNode":"p4_router","fromSide":"right","toNode":"p4_llm","toSide":"left","color":"#10b981"},
		{"id":"e_p4_3","fromNode":"p4_llm","fromSide":"right","toNode":"p4_valid","toSide":"left","color":"#10b981"},
		{"id":"e_p4_4","fromNode":"p4_valid","fromSide":"bottom","toNode":"p4_output","toSide":"right","color":"#10b981"},
		{"id":"e_p4_to_memory","fromNode":"p4_output","fromSide":"right","toNode":"p5_session","toSide":"left","color":"#8b5cf6","label":"Save conversation & extract facts"},
		{"id":"e_memory_to_p4","fromNode":"p5_session","fromSide":"left","toNode":"p4_sys","toSide":"right","color":"#8b5cf6","label":"Session context, relevant facts"},
		{"id":"e_p5_1","fromNode":"p5_session","fromSide":"bottom","toNode":"p5_facts","toSide":"top","color":"#8b5cf6"},
		{"id":"e_p5_2","fromNode":"p5_session","fromSide":"right","toNode":"p5_sqlite","toSide":"left","color":"#8b5cf6"},
		{"id":"e_p5_3","fromNode":"p5_sqlite","fromSide":"bottom","toNode":"p5_notes","toSide":"top","color":"#8b5cf6"},
		{"id":"e_agents_to_retrieval","fromNode":"p6_search","fromSide":"left","toNode":"p3_query","toSide":"right","color":"#ec4899","label":"search_book() triggers retrieval"},
		{"id":"e_agents_to_memory","fromNode":"p6_notes_tool","fromSide":"bottom","toNode":"p5_notes","toSide":"right","color":"#ec4899","label":"create_note(), search_notes()"},
		{"id":"e_p6_1","fromNode":"p6_router","fromSide":"bottom","toNode":"p6_search","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_2","fromNode":"p6_router","fromSide":"bottom","toNode":"p6_notes_tool","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_3","fromNode":"p6_search","fromSide":"bottom","toNode":"p6_study","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_4","fromNode":"p6_notes_tool","fromSide":"bottom","toNode":"p6_analysis","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_5","fromNode":"p6_study","fromSide":"bottom","toNode":"p6_react","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_6","fromNode":"p6_analysis","fromSide":"bottom","toNode":"p6_react","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_7","fromNode":"p6_react","fromSide":"bottom","toNode":"p6_guards","toSide":"top","color":"#ec4899"},
		{"id":"e_p4_to_deploy","fromNode":"p4_output","fromSide":"bottom","toNode":"p8_chainlit","toSide":"top","color":"#10b981","label":"Streaming response"},
		{"id":"e_eval_1","fromNode":"p7_dataset","fromSide":"bottom","toNode":"p7_ragas","toSide":"top"},
		{"id":"e_eval_2","fromNode":"p7_dataset","fromSide":"right","toNode":"p7_latency","toSide":"left"},
		{"id":"e_eval_3","fromNode":"p7_ragas","fromSide":"right","toNode":"p7_deep","toSide":"left"}
	]
}
