{
	"nodes":[
		{"id":"g3","type":"group","x":960,"y":1380,"width":1900,"height":830,"color":"4","label":"PHASE 3: RETRIEVAL PIPELINE ✅ BUILT + ENHANCED (rerank + HyDE + classify) — ~$0.001/query"},
		{"id":"g2","type":"group","x":960,"y":530,"width":1900,"height":760,"color":"6","label":"PHASE 2: INDEXING PIPELINE ✅ BUILT + ENRICHED (RAPTOR ⏳) — $0.35 actual"},
		{"id":"g4","type":"group","x":960,"y":2360,"width":1900,"height":420,"color":"5","label":"PHASE 4: GENERATION ✅ BUILT + VALIDATED (router ⏳) — $0.001/query"},
		{"id":"g6","type":"group","x":3060,"y":2060,"width":750,"height":1020,"color":"2","label":"PHASE 6: AGENTIC LAYER — ⏳ NOT YET STARTED"},
		{"id":"g1","type":"group","x":960,"y":0,"width":1900,"height":380,"color":"1","label":"PHASE 1: DOCUMENT PROCESSING ✅ BUILT — $0.06 actual"},
		{"id":"g5","type":"group","x":3060,"y":980,"width":750,"height":800,"color":"3","label":"PHASE 5: MEMORY & PERSISTENCE — ✅ basic SQLite, advanced ⏳"},
		{"id":"g7","type":"group","x":960,"y":2930,"width":950,"height":500,"color":"4","label":"EVALUATION & TESTING — ⏳ NOT YET STARTED"},
		{"id":"g8","type":"group","x":2060,"y":2930,"width":800,"height":500,"color":"5","label":"DEPLOYMENT"},
		{"id":"f1","type":"file","file":"02-document-processing/Overview.md","x":4320,"y":-290,"width":1680,"height":6700},
		{"id":"f2","type":"file","file":"03-indexing-pipeline/Overview.md","x":6080,"y":-290,"width":1020,"height":13210},
		{"id":"f3","type":"file","file":"04-retrieval-pipeline/Overview.md","x":7160,"y":-290,"width":1680,"height":10210},
		{"id":"f4","type":"file","file":"05-generation-layer/Overview.md","x":8880,"y":-290,"width":1860,"height":8050},
		{"id":"f5","type":"file","file":"06-memory-persistence/Overview.md","x":10800,"y":-290,"width":1200,"height":10150},
		{"id":"f6","type":"file","file":"07-agentic-layer/Overview.md","x":12040,"y":-290,"width":2200,"height":12370},
		{"id":"f7","type":"file","file":"08-evaluation-testing/Overview.md","x":14280,"y":-290,"width":1680,"height":10570},
		{"id":"f8","type":"file","file":"09-deployment/Overview.md","x":16000,"y":-290,"width":1280,"height":11170},
		{"id":"p5_budget","type":"text","text":"**Context Window Budget**\nTier 1 Core: 2,200 tokens (cached)\nTier 2 Working: 7,500 tokens\nTier 3 Long-term: unlimited (SQLite)\nTotal per query: ~10,700 tokens","x":3210,"y":1390,"width":320,"height":160,"color":"3"},
		{"id":"p5_facts","type":"text","text":"**Auto Fact Extraction**\nKey facts saved from every\nresponse, with embeddings\nfor semantic retrieval","x":3160,"y":1230,"width":280,"height":120,"color":"3"},
		{"id":"p5_session","type":"text","text":"**Session Manager** ✅ basic\nSession create + history\nLast 20 turns loaded\nCompression/summary: ⏳","x":3160,"y":1070,"width":280,"height":120,"color":"3"},
		{"id":"p5_sqlite","type":"text","text":"**SQLite Database** ✅\n`data/memory.db`\nconversations table\nsessions table","x":3510,"y":1070,"width":240,"height":120,"color":"3"},
		{"id":"p5_notes","type":"text","text":"**User Notes & Plans**\nPersistent across sessions\nTagged and searchable","x":3510,"y":1230,"width":240,"height":120,"color":"3"},
		{"id":"p6_router","type":"text","text":"**Agent Router (Intent Detection)**\nDirect question → RAG pipeline\nTool request → Tool Executor\nNative Claude/Gemini tool use","x":3210,"y":2090,"width":320,"height":120,"color":"2"},
		{"id":"p6_search","type":"text","text":"**search_book()**\nQuery the book\n**get_page()**\nFull page text","x":3160,"y":2300,"width":220,"height":110,"color":"2"},
		{"id":"p6_notes_tool","type":"text","text":"**create_note()**\nSave study notes\n**search_notes()**\nFind past notes","x":3450,"y":2300,"width":220,"height":110,"color":"2"},
		{"id":"p6_analysis","type":"text","text":"**summarize_chapter()**\nChapter summaries\n**compare_concepts()**\nSide-by-side analysis","x":3450,"y":2440,"width":220,"height":110,"color":"2"},
		{"id":"p6_study","type":"text","text":"**create_plan()**\nStudy/training plans\n**create_flashcards()**\nQ&A card generation","x":3160,"y":2440,"width":220,"height":110,"color":"2"},
		{"id":"p6_react","type":"text","text":"**ReAct Execution Loop**\nReason → Act → Observe → Repeat\nMax 5 tool calls per query\nNo framework — native API tool use","x":3210,"y":2590,"width":320,"height":120,"color":"2"},
		{"id":"p6_guards","type":"text","text":"**Guardrails**\nInput validation per tool\nCost controls: $2/day budget\nRate limiting, size limits","x":3210,"y":2750,"width":320,"height":120,"color":"2"},
		{"id":"p2_raptor","type":"text","text":"**RAPTOR Summaries**\nTree of Abstractions\nL0: 300 chunks\nL1: ~30 cluster summaries\nL2: ~5 section summaries\nL3: 1 book summary","x":2100,"y":655,"width":280,"height":190,"color":"6"},
		{"id":"p2_bm25","type":"text","text":"**BM25 Index Build** ✅\nrank_bm25 (OkapiBM25)\nPlain dict chunks in pickle\nKeyword matching","x":1840,"y":875,"width":260,"height":130,"color":"6"},
		{"id":"p2_embed","type":"text","text":"**gemini-embedding-001** ✅\n3072 dims, #1 MTEB (68.32)\nFree tier / $0.001 per batch\nAlt: Voyage-4-large (MoE)","x":1060,"y":940,"width":270,"height":90,"color":"6"},
		{"id":"p2_chroma","type":"text","text":"**ChromaDB** ✅ `data/chroma_db/`\nFree, local, cosine similarity","x":1060,"y":1080,"width":240,"height":60},
		{"id":"p2_bm25_store","type":"text","text":"**BM25 Index** File\n`bm25_index.pkl`","x":1710,"y":1140,"width":240,"height":70},
		{"id":"p2_enrich","type":"text","text":"**Contextual Enrichment** ✅\nAnthropic Method (confirmed 2026)\n35% alone, 49% +BM25, 67% +rerank\nActual cost: ~$0.35 one-time","x":1360,"y":770,"width":280,"height":140,"color":"6"},
		{"id":"p2_chunk","type":"text","text":"**Semantic Chunking** ✅\n~400 tokens, 80 overlap\nCross-page paragraph splits\nDedup + skip front/back matter\n146 chunks from 202 pages","x":1360,"y":610,"width":280,"height":140,"color":"6"},
		{"id":"f0","type":"file","file":"01-system-overview/System Diagram.md","x":1260,"y":-130,"width":400,"height":50},
		{"id":"p1_ocr","type":"text","text":"**Gemini 2.0 Flash** ✅\n**OCR Transcription**\n$0.06 actual for 232 pages\n232/232, 0 failures","x":1380,"y":80,"width":270,"height":110,"color":"1"},
		{"id":"p7_deep","type":"text","text":"**DeepEval Metrics**\nHallucination < 0.1\nAnswer Correctness > 0.8\nContextual Relevancy > 0.8\nToxicity & Bias checks","x":1430,"y":3170,"width":280,"height":200},
		{"id":"p7_ragas","type":"text","text":"**RAGAS Metrics**\nFaithfulness > 0.9\nAnswer Relevancy > 0.85\nContext Precision > 0.8\nContext Recall > 0.8","x":1060,"y":3170,"width":280,"height":200},
		{"id":"p7_latency","type":"text","text":"**Latency Benchmarks**\nSimple query: < 3s (first token)\nComplex query: < 6s (first token)\nVector search: < 50ms\nRerank: < 300ms","x":1430,"y":3010,"width":280,"height":160},
		{"id":"p7_dataset","type":"text","text":"**Test Dataset**\n50+ gold Q&A pairs\n7 categories: factual,\nconceptual, cross-chapter,\npage-specific, summary, negative","x":1060,"y":2975,"width":280,"height":175},
		{"id":"p8_cost","type":"text","text":"**Total Cost**\nOne-time setup: **$0.62**\nMonthly (50 q/day): **$13.65**\nPer query average: **$0.009**\nInfrastructure: **Free** (local)","x":2160,"y":3170,"width":280,"height":160},
		{"id":"p8_stack","type":"text","text":"**Tech Stack**\nPython 3.12 + Chainlit\nSQLite + ChromaDB\nAll local, fully portable\nNo cloud infra required","x":2520,"y":3170,"width":260,"height":160},
		{"id":"p8_chainlit","type":"text","text":"**Chainlit Chat UI** ✅\nStreaming responses\nSource citations in sidebar\nWelcome message\n`chainlit run app.py` → :8000","x":2160,"y":3010,"width":280,"height":160,"color":"5"},
		{"id":"p8_docker","type":"text","text":"**Docker Deployment**\nSingle container\nPersistent volume for data\nPython 3.12-slim base\nPort 8000","x":2520,"y":3010,"width":260,"height":160,"color":"5"},
		{"id":"p3_multi","type":"text","text":"**Multi-Query Expansion** ✅\n2 variants + original (3 total)\nGemini Flash generation\nFallback to original on error","x":1060,"y":1600,"width":270,"height":125,"color":"4"},
		{"id":"p3_vector","type":"text","text":"**Vector Search** ✅\nTop-20 per query (×3 queries)\nChromaDB cosine similarity","x":1060,"y":1760,"width":250,"height":140,"color":"4"},
		{"id":"p3_classify","type":"text","text":"**Query Understanding** ✅\n**& Classification**\n6 types: factual, conceptual,\ncomparative, page, summary, chat\nRoutes HyDE for conceptual queries","x":1360,"y":1430,"width":280,"height":140,"color":"4"},
		{"id":"p3_hyde","type":"text","text":"**HyDE** ✅\nHypothetical Answer\nEmbed answer, not question\nFor conceptual queries only","x":1430,"y":1600,"width":270,"height":125,"color":"4"},
		{"id":"p3_query","type":"text","text":"**User Query**\nor Agent tool call","x":1060,"y":1460,"width":200,"height":90,"color":"4"},
		{"id":"p3_bm25s","type":"text","text":"**BM25 Search** ✅\nTop-20 per query (×3 queries)\nKeyword matching via rank_bm25","x":1430,"y":1760,"width":250,"height":140,"color":"4"},
		{"id":"p3_rrf","type":"text","text":"**Reciprocal Rank Fusion** ✅\nMerge & Deduplicate\nk=60 constant\nStill gold standard for hybrid","x":1790,"y":1725,"width":280,"height":105,"color":"4"},
		{"id":"p3_rerank","type":"text","text":"**LLM Reranker** ✅\nGemini 2.5 Flash cross-encoder\nScores top-15 candidates 0-10\nReturns top-5 by relevance\nCost: ~$0.0002/query","x":1790,"y":1900,"width":280,"height":130,"color":"4"},
		{"id":"p3_assemble","type":"text","text":"**Context Assembly** ✅\nTop-5 chunks, relevance-ordered\nPage citations per chunk\n~4,000 tokens output","x":2190,"y":1900,"width":280,"height":150,"color":"4"},
		{"id":"p4_sys","type":"text","text":"**System Prompt** ✅\nBook Expert Persona\n7 citation rules\n+ context + history (last 20)\nPrompt caching: ⏳ planned","x":1060,"y":2440,"width":280,"height":170,"color":"5"},
		{"id":"p4_router","type":"text","text":"**Model Router** ⏳ PLANNED\nSimple → gemini-2.5-flash\nComplex → claude-sonnet-4-5\nCurrently: all Gemini Flash","x":1430,"y":2440,"width":270,"height":170,"color":"5"},
		{"id":"p4_llm","type":"text","text":"**LLM Generation** ✅\ngemini-2.5-flash (migrated)\nStreaming via generate_content_stream\nAll API calls on 2.5-flash","x":1790,"y":2440,"width":280,"height":130,"color":"5"},
		{"id":"p4_valid","type":"text","text":"**Response Validation** ✅\nCitation Check: [Page X] exists\nin retrieved context? Flags\nhallucinated page refs with\nwarning note to user","x":2160,"y":2440,"width":270,"height":130,"color":"5"},
		{"id":"p4_output","type":"text","text":"**Answer with Page Citations**\n~$0.009 average per query","x":1560,"y":2650,"width":340,"height":90},
		{"id":"title","type":"text","text":"# Book Expert RAG\n## Complete System Architecture\n*The New Toughness Training for Sports* — 232 pages → Conversational AI Expert","x":1260,"y":-300,"width":700,"height":120},
		{"id":"p1_output","type":"text","text":"**Clean Markdown with Page Metadata**\n~70,000 words ready for indexing","x":1660,"y":225,"width":340,"height":85},
		{"id":"p1_clean","type":"text","text":"**Text Cleaning**\n**& Normalization**\nHyphen rejoin, Unicode fix\nRemove headers/footers","x":1740,"y":80,"width":260,"height":110,"color":"1"},
		{"id":"p1_struct","type":"text","text":"**Structure Extraction**\nChapters, Sections\nHeading detection\nCross-reference linking","x":2090,"y":80,"width":260,"height":110,"color":"1"},
		{"id":"p1_quality","type":"text","text":"**Quality Validation**\nComposite Score 0-100\nSpelling, OCR confidence\nMulti-pass: Flash then Pro","x":2440,"y":80,"width":260,"height":110,"color":"1"},
		{"id":"p1_input","type":"text","text":"**232 JPG Page Images**\n`page_0001.jpg`\nthrough\n`page_0232.jpg`","x":1060,"y":80,"width":230,"height":110,"color":"1"}
	],
	"edges":[
		{"id":"e_p1_1","fromNode":"p1_input","fromSide":"right","toNode":"p1_ocr","toSide":"left","color":"#e94560"},
		{"id":"e_p1_2","fromNode":"p1_ocr","fromSide":"right","toNode":"p1_clean","toSide":"left","color":"#e94560"},
		{"id":"e_p1_3","fromNode":"p1_clean","fromSide":"right","toNode":"p1_struct","toSide":"left","color":"#e94560"},
		{"id":"e_p1_4","fromNode":"p1_struct","fromSide":"right","toNode":"p1_quality","toSide":"left","color":"#e94560"},
		{"id":"e_p1_5","fromNode":"p1_quality","fromSide":"bottom","toNode":"p1_output","toSide":"right","color":"#e94560"},
		{"id":"e_p1_to_p2","fromNode":"p1_output","fromSide":"bottom","toNode":"p2_chunk","toSide":"top","color":"#f59e0b","label":"Clean Markdown"},
		{"id":"e_p2_1","fromNode":"p2_chunk","fromSide":"bottom","toNode":"p2_enrich","toSide":"top","color":"#f59e0b"},
		{"id":"e_p2_2","fromNode":"p2_enrich","fromSide":"bottom","toNode":"p2_embed","toSide":"top","color":"#f59e0b","label":"Enriched chunks"},
		{"id":"e_p2_3","fromNode":"p2_enrich","fromSide":"bottom","toNode":"p2_bm25","toSide":"top","color":"#f59e0b","label":"Enriched chunks"},
		{"id":"e_p2_4","fromNode":"p2_chunk","fromSide":"right","toNode":"p2_raptor","toSide":"left","color":"#f59e0b","label":"Raw chunks"},
		{"id":"e_p2_5","fromNode":"p2_embed","fromSide":"bottom","toNode":"p2_chroma","toSide":"top","color":"#f59e0b"},
		{"id":"e_p2_6","fromNode":"p2_bm25","fromSide":"bottom","toNode":"p2_bm25_store","toSide":"top","color":"#f59e0b"},
		{"id":"e_p2_7","fromNode":"p2_raptor","fromSide":"bottom","toNode":"p2_chroma","toSide":"right","color":"#f59e0b","label":"Summary embeddings"},
		{"id":"e_store_to_vector","fromNode":"p2_chroma","fromSide":"bottom","toNode":"p3_vector","toSide":"top","color":"#3b82f6","label":"Vector Store"},
		{"id":"e_store_to_bm25","fromNode":"p2_bm25_store","fromSide":"bottom","toNode":"p3_bm25s","toSide":"top","color":"#3b82f6","label":"BM25 Index"},
		{"id":"e_p3_1","fromNode":"p3_query","fromSide":"right","toNode":"p3_classify","toSide":"left","color":"#3b82f6"},
		{"id":"e_p3_2","fromNode":"p3_classify","fromSide":"bottom","toNode":"p3_multi","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_3","fromNode":"p3_classify","fromSide":"bottom","toNode":"p3_hyde","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_4","fromNode":"p3_multi","fromSide":"bottom","toNode":"p3_vector","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_5","fromNode":"p3_multi","fromSide":"bottom","toNode":"p3_bm25s","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_6","fromNode":"p3_hyde","fromSide":"bottom","toNode":"p3_vector","toSide":"top","color":"#3b82f6"},
		{"id":"e_p3_7","fromNode":"p3_vector","fromSide":"right","toNode":"p3_rrf","toSide":"left","color":"#3b82f6","label":"Top-50"},
		{"id":"e_p3_8","fromNode":"p3_bm25s","fromSide":"right","toNode":"p3_rrf","toSide":"left","color":"#3b82f6","label":"Top-50"},
		{"id":"e_p3_9","fromNode":"p3_rrf","fromSide":"bottom","toNode":"p3_rerank","toSide":"top","color":"#3b82f6","label":"~80 unique"},
		{"id":"e_p3_10","fromNode":"p3_rerank","fromSide":"right","toNode":"p3_assemble","toSide":"left","color":"#3b82f6","label":"Top-5"},
		{"id":"e_p3_to_p4","fromNode":"p3_assemble","fromSide":"bottom","toNode":"p4_sys","toSide":"top","color":"#10b981","label":"Retrieved Context"},
		{"id":"e_p4_1","fromNode":"p4_sys","fromSide":"right","toNode":"p4_router","toSide":"left","color":"#10b981"},
		{"id":"e_p4_2","fromNode":"p4_router","fromSide":"right","toNode":"p4_llm","toSide":"left","color":"#10b981"},
		{"id":"e_p4_3","fromNode":"p4_llm","fromSide":"right","toNode":"p4_valid","toSide":"left","color":"#10b981"},
		{"id":"e_p4_4","fromNode":"p4_valid","fromSide":"bottom","toNode":"p4_output","toSide":"right","color":"#10b981"},
		{"id":"e_p4_to_memory","fromNode":"p4_output","fromSide":"right","toNode":"p5_session","toSide":"left","color":"#8b5cf6","label":"Save conversation & extract facts"},
		{"id":"e_memory_to_p4","fromNode":"p5_session","fromSide":"left","toNode":"p4_sys","toSide":"right","color":"#8b5cf6","label":"Session context, relevant facts"},
		{"id":"e_p5_1","fromNode":"p5_session","fromSide":"bottom","toNode":"p5_facts","toSide":"top","color":"#8b5cf6"},
		{"id":"e_p5_2","fromNode":"p5_session","fromSide":"right","toNode":"p5_sqlite","toSide":"left","color":"#8b5cf6"},
		{"id":"e_p5_3","fromNode":"p5_sqlite","fromSide":"bottom","toNode":"p5_notes","toSide":"top","color":"#8b5cf6"},
		{"id":"e_agents_to_retrieval","fromNode":"p6_search","fromSide":"left","toNode":"p3_query","toSide":"right","color":"#ec4899","label":"search_book() triggers retrieval"},
		{"id":"e_agents_to_memory","fromNode":"p6_notes_tool","fromSide":"bottom","toNode":"p5_notes","toSide":"right","color":"#ec4899","label":"create_note(), search_notes()"},
		{"id":"e_p6_1","fromNode":"p6_router","fromSide":"bottom","toNode":"p6_search","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_2","fromNode":"p6_router","fromSide":"bottom","toNode":"p6_notes_tool","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_3","fromNode":"p6_search","fromSide":"bottom","toNode":"p6_study","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_4","fromNode":"p6_notes_tool","fromSide":"bottom","toNode":"p6_analysis","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_5","fromNode":"p6_study","fromSide":"bottom","toNode":"p6_react","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_6","fromNode":"p6_analysis","fromSide":"bottom","toNode":"p6_react","toSide":"top","color":"#ec4899"},
		{"id":"e_p6_7","fromNode":"p6_react","fromSide":"bottom","toNode":"p6_guards","toSide":"top","color":"#ec4899"},
		{"id":"e_p4_to_deploy","fromNode":"p4_output","fromSide":"bottom","toNode":"p8_chainlit","toSide":"top","color":"#10b981","label":"Streaming response"},
		{"id":"e_eval_1","fromNode":"p7_dataset","fromSide":"bottom","toNode":"p7_ragas","toSide":"top"},
		{"id":"e_eval_2","fromNode":"p7_dataset","fromSide":"right","toNode":"p7_latency","toSide":"left"},
		{"id":"e_eval_3","fromNode":"p7_ragas","fromSide":"right","toNode":"p7_deep","toSide":"left"}
	]
}